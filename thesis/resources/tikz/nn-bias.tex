\tikzset{
  connect arrow/.style={->, draw=gray}
}

% LAYERS IN NEURAL NETWORK
\begin{tikzpicture}[scale=1.25,x=2.2cm,y=1.4cm]

  \message{^^Layers in Neural network}
  \readlist\Nnod{4,5,5,5,3} % array of number of nodes per layer
  \readlist\Nstr{n,m,m,m,k} % array of string number of nodes per layer
  % \readlist\Cstr{\strut x,a^{(\prev)},a^{(\prev)},a^{(\prev)},y} % array of coefficient symbol per layer
  \def\yshift{0.5} % shift last node for dots
  
  \message{^^Drawing Layers}
  \foreachitem \N \in \Nnod { % loop over layers
    \def\lay{\Ncnt} % current layer index
    \pgfmathsetmacro\prev{int(\Ncnt - 1)} % previous layer index
    \message{\lay,}

    % Number of total nodes in this layer including bias if not last
    \ifnum\lay<\Nnodlen
      \pgfmathsetmacro\Nwithbias{\N + 1}
      \def\firstIndex{0}
    \else
      \pgfmathsetmacro\Nwithbias{\N}
      \def\firstIndex{1}
    \fi

    % All neurons in layer: bias (index 0) + regular (1..N)
    \foreach \i [evaluate={
        \c=int(\i==\N);
        \y=\N/2-\i-\c*\yshift;
        \x=\lay; \n=\nstyle;
      }] in {\firstIndex,...,\N} {

      % \node[node \n] (N\lay-\i) at (\x,\y) {};

      \ifnum\i=0
        % \node[circle, draw=teal!60!black, fill=teal!20, minimum size=8pt, inner sep=2pt] (N\lay-\i) at (\x,\y) {};
        \node[node bias] (N\lay-\i) at (\x,\y) {1};
      \else
        \node[node \n] (N\lay-\i) at (\x,\y) {};
      \fi

      % Only connect if NOT bias node
      \ifnum\i>0
        \ifnum\lay>1
          \ifnum\prev<\Nnodlen
            \foreach \j in {0,...,\Nnod[\prev]} {
              \draw[connect arrow] (N\prev-\j) -- (N\lay-\i);
            }
          \else
            \foreach \j in {1,...,\Nnod[\prev]} {
              \draw[connect arrow] (N\prev-\j) -- (N\lay-\i);
            }
          \fi
        \fi
      \fi
    }

    % Dots
    \path (N\lay-\N) --++ (0,1+\yshift) node[midway,scale=1.5] {$\vdots$};
  }
  
  % RECTANGLE
  % \node[
  %   draw=myblue!40,
  %   fill=myblue,
  %   fill opacity=0.02,
  %   rounded corners=2,
  %   inner sep=10pt,
  %   fit=(N2-1)(N4-5)
  % ] {};

  % LABELS
  % \node[above=5,align=center,softorange!60!black] at (N1-1.90) {vhodni\\[-0.2em]sloj};
  % \node[above=10,align=center,myblue!60!black] at (N3-1.90) {skriti sloji};
  % \node[above=5,align=center,myred!60!black] at (N\Nnodlen-1.90) {izhodni\\[-0.2em]sloj};
  
\end{tikzpicture}
